# GRNTIClass: Руководство пользователя

## Основной функционал программы

Программа поддерживает 3 режима работы (команды):
1. **models**: Просмотр и установка моделей классификации текстов;
2. **predict**: Запуск классификации с использованием флагов коммандной строки;
3. **server**: Запуск сервера для классификации.

Все команды поддерживают флаг **-h**(**--help**) для получения дополнительной информации о командах.
### Основные флаги программы
|**Аргумент**|**Ключ**|**Допустимые<br>значения**|**Обязательный<br>аргумент**|**По-умолчанию**|
|:-------------|:-------------|:-------------|:-------------|:-------------|
|Показать версию программы|-v,<br>--version|-|нет|-|
|Смена языка интерфейса программы|-l,<br>--lang|-|нет|-|

## Просмотр и установка доступных моделей

Этот режим работы необходим для работы с моделями классификации и поддерживает три подкоманды:
1. **config**: Команда установки пути к конфигурационному файлу.
   1. Доступен флаг **-p** (**--path**) для задания пути к конфигурационному файлу.
      1. **Пример**: ```./GRNTIClass.exe models config -p config.json```
2. **install**: Скачивание и установка моделей классификации с сервера
   1. **Разработка в процессе!**
3. **list**: Вывод установленных моделей или моделей, доступных онлайн.
   1. При использовании без дополнительных флагов выводит списко установленных моделей.
      1. **Пример**: ```./GRNTIClass.exe models list```
   2. При использовании флага **-o**(**--online**) выводит список доступных моделей для скачивания и установки.
      1. **Функционал в процессе разработки!**
      2. **Пример**: ```./GRNTIClass.exe models list -o```


## Запуска классификации с использованием командной строки
|**Аргумент**|**Ключ**|**Допустимые<br>значения**|**Обязательный<br>аргумент**|**По-умолчанию**|
|:-------------|:-------------|:-------------|:-------------|:-------------|
|Входной файл|-i|Путь к существующему файлу|да|text.txt|
|Результирующий файл|-o|Путь к файлу в существующей папке|да|result.csv|
|Кодировка входного файла|-ei|**Кодировки для python3.10**|нет|cp1251|
|Кодировка выходного файла|-eo|**Кодировки для python3.10**|нет|cp1251|
|Идентификатор рубрикатора|-id|**RGNTI1** означает ГРНТИ 1-го уровня<br>**RGNTI2** означает ГРНТИ 2-го уровня<br>**RGNTI3** означает ГРНТИ 3-го уровня|да|RGNTI3|
|Размер пакета текстов для классификации|-p|Целое число|нет|1|
|Формат файла|-f|**plain**, **multidoc**|да|plain|
|Язык|-l|**ru**, **en**|да|ru|
|Минимальная вероятность<br>рубрики (порог)|-t|Число от 0 до 1, десятичный разделитель - точка|да|0.5|
|Нормализация|-n|**not**, **some**, **all**|нет|not|
|Выбор устройства выполнения|-dv|**cpu**, **cuda:0**|нет|cpu|
|Использование диалогового<br>взаимодействия с программой|-d|-|нет|-|
|Включение режима без логов|-s|-|нет|-|
|Максимальное количество процессов для загрузки данных|-w|Целое число|нет|1|

Без нормализации вероятность принадлежности текста каждому классу находится вдиапазоне от 0 до 1 без ограничений, их сумма может превосходить 1. При нормализациивероятности масштабируются так, чтобы их сумма была равна 1. Нормализация выполняетсяделением на сумму вероятностей.
* **not**: не выполнять нормализацию;
* **some**: выполнять нормализацию, если сумма предсказанных вероятностей рубрик больше 1
* **all**: выполнить нормализацию.

Отсечение результатов классификации по порогу вероятности, заданному ключом **-t**, применяется до применения ключа **-n**.

### Пример запуск
```powershell
./GRNTIClass.exe predict -i test_ru.csv -o results.csv -id RGNTI2 -f multidoc -l ru -t 0.1
```

### Формат входных данных

Классификатор принимает тексты в одном из двух текстовых форматов: **plain** и **multidoc**. Кодировка входного файла — **cp1251**.
Далее в примерах символ табуляции обозначен стрелкой (→), символы возврата каретки и конца строки обозначены как \<CR> и \<LF> соответственно.
#### Формат plain
Простой текст без разделения на поля. Может содержать произвольное количество строк.
##### Пример
> Взрослые особи в среднем весят 30 грамм и имеют длину от 19 до 20 см. Спина тускло-серо-коричневая с характерной чёрной полосой под глазами от клюва до шеи[5].\<CR>\<LF><br>
Хвостовая часть бледно-белая, а грудь светло-лососевого цвета. Ноги и лапы чёрные, глазакоричневые, клюв чёрный, хвост серый, снизу кремовый с коричневатыми полосами.\<CR>\<LF><br>
Молодые особи имеют более тусклый окрас с более коричневой полосой на глазах[3].\<CR>\<LF>
#### Формат multidoc
Файл с заголовком произвольным количеством строк. Аналогичен формату CSV с табулятором в качестве разделителя. Колонки:
* **id**: идентификатор текста;
* **title**: название;
* **body**: основной текст;
* **keywords**: ключевые слова;
* **correct**: содержит только признак валидности - три решетки ###.

Допускается пустая строка в полях title, body, keywords, но как минимум одно из этих полей должно быть непустое. Содержимое этих трёх полей склеивается через пробел и превращается в одну непустую текстовую строку, которая отправляется на классификацию.
##### Пример
> id→title→body→keywords→correct\<CR>\<LF><br>
B11864306371→Первичные материалы о коллемболах (Insecta: Collembola) пояса полярной пустыни Хибин→Большинство … проблем промышленной экологии Севера Кольского НЦ РАН.→Collembola\Мурманская область\Хибинские горы\биотопы\видовое разнообразие\новые находки\фауна→###\<CR>\<LF><br>
B11864306428→Сравнительная характеристика зараженности промысловых пелагических и донных рыб Баренцева моря опасными для здоровья человека личинками нематоды Anisakis simplex→Сравнительный анализ показал существенные различия в характере зараженности личинками Anisakis simplex рыб, отличающихся по своей экологии и трофо-паразитарным связям. Россия, Полярный НИИ морского рыбного хозяйства и океанографии им. Н.М.Книповича.→Anisakis simplex (Nem.)\Баренцево море\видовое разнообразие\новые находки\паразитофауна\промысловые рыбы→###\<CR>\<LF><br>
B11864306754→Структура населения шмелей (Hymenoptera, Apidae, Bombus spp.) Восточной Фенноскандии→Установлено, что при изменении условий обитания шмели способны к трансформации жизненных циклов. Такая способность обусловлена как географической широтой, так и фенологическими и генетическими особенностями разных видов шмелей. Россия, Институт экологических проблем Севера УрО РАН.→Скандинавия\абиотические факторы\биотопы\видовое разнообразие\распределение по территории\фауна\шмели→###\<CR>\<LF>

Ключевые слова в поле *keywords* могут разделяться символом обратный слэш или символом точка с запятой. Для программы классификации оба эти разделителя равносильны запятой с пробелом.

### Формат сохранения результата
Результат классификации сохраняется в виде CSV-таблицы с табулятором в качестве разделителя. Выходной файл имеет кодировку cp-1251. Таблица имеет одинаковый вид вне зависимости от формата входных текстов (**plain** или **multidoc**).

Первая строка – заголовок таблицы, который содержит названия колонок:
> id→result→rubricator→language→threshold→version→normalize→correct

Далее в каждой строке идут значения этих полей, разделенные табуляцией. В файле входного формата **plain** отсутствует идентификатор документа, поэтому в выходной файл вместо идентификатора записывается символ #.

Результат в поле **result** записывается в формате:
> Код1-Вероятность1/Код2-Вероятность2/Код3-Вероятность3/…

* Если из-за высокого порога вероятности в результат не попала ни одна рубрика, в это поле ставится значение **EMPTY**.
* Если произошел отказ от классификации, в поле result записывается значение **REJECT**.
#### Примеры
##### Формат plain
> id→result→rubricator→language→threshold→version→normalize→correct\<CR>\<LF><br>
#→68.35-0.33275\34.23-0.29211\34.31-0.12737→RGNTI→ru→0.1→1.7.1p3.0v3.0c→not→###\<CR>\<LF>
##### Формат multidoc
> id→result→rubricator→language→threshold→version→normalize→correct\<CR>\<LF><br>
J18860149882→68.35-0.33275\34.23-0.29211\34.31-0.12737→RGNTI→ru→0.1→1.7.1p3.0v3.0c→not→###\<CR>\<LF><br>
J0805808035→EMPTY→RGNTI→ru→0.1→1.7.0p3.0v3.0c→not→###\<CR>\<LF><br>
J08423714116→REJECT→RGNTI→ru→0.1→1.7.0p3.0v3.0c→not→###\<CR>\<LF>

## Запуск сервера для классификации

Команда запуска программы в серверном формате.
